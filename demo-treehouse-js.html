<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TreeHouse JavaScript Library Demo</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f8fafc;
        }
        .container { max-width: 800px; margin: 0 auto; }
        .header {
            text-align: center;
            margin-bottom: 40px;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .demo-section {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .demo-form {
            margin: 20px 0;
        }
        .demo-form input, .demo-form textarea, .demo-form button {
            display: block;
            width: 100%;
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .demo-form button {
            background: #007bff;
            color: white;
            border: none;
            cursor: pointer;
        }
        .demo-form button:hover {
            background: #0056b3;
        }
        .form-message {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .form-message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .form-message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .field-error {
            color: #dc3545;
            font-size: 0.875em;
            margin-top: 5px;
        }
        .form-spinner {
            text-align: center;
            padding: 20px;
        }
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #007bff;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        code {
            background: #f7fafc;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'SF Mono', Monaco, monospace;
            font-size: 0.9em;
        }
        .code-block {
            background: #f7fafc;
            padding: 15px;
            border-radius: 4px;
            font-family: 'SF Mono', Monaco, monospace;
            font-size: 0.9em;
            overflow-x: auto;
            margin: 15px 0;
        }
        .module-status {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        .module-status.loaded {
            background: #d4edda;
            border-color: #c3e6cb;
        }
        .module-status.loading {
            background: #fff3cd;
            border-color: #ffeaa7;
        }
    </style>
    
    <!-- TreeHouse Framework Configuration -->
    <script>
        // This would normally be generated by PHP helpers
        if (window.TreeHouse) {
            window.TreeHouse.configure({
                "csrf": {
                    "endpoint": "/_csrf/token",
                    "field": "_token"
                },
                "baseUrl": "/_assets/treehouse",
                "debug": true
            });
        }
    </script>
    
    <!-- TreeHouse Core Library -->
    <script src="/_assets/treehouse/js/treehouse.js" defer></script>
    
    <!-- TreeHouse Modules -->
    <script src="/_assets/treehouse/js/modules/csrf.js" defer></script>
    <script src="/_assets/treehouse/js/modules/forms.js" defer></script>
    <script src="/_assets/treehouse/js/modules/utils.js" defer></script>
    
    <!-- CSRF Meta Tag for Dynamic Injection -->
    <meta name="csrf-token" content="" data-csrf-meta="true">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>TreeHouse JavaScript Library Demo</h1>
            <p>Demonstration of the vendor-first TreeHouse JavaScript framework</p>
        </div>
        
        <div class="demo-section">
            <h2>üì¶ Module System</h2>
            <p>TreeHouse uses a modular architecture where modules can be loaded on demand:</p>
            
            <div id="module-status">
                <div class="module-status loading" data-module="csrf">
                    <strong>CSRF Module:</strong> <span class="status">Loading...</span>
                </div>
                <div class="module-status loading" data-module="forms">
                    <strong>Forms Module:</strong> <span class="status">Loading...</span>
                </div>
                <div class="module-status loading" data-module="utils">
                    <strong>Utils Module:</strong> <span class="status">Loading...</span>
                </div>
            </div>
            
            <div class="code-block">
// Load modules on demand
TreeHouse.use('csrf').then(() => {
    console.log('CSRF module loaded');
});

// Or use multiple modules
TreeHouse.ready(() => {
    TreeHouse.use('forms');
    TreeHouse.use('utils');
});
            </div>
        </div>
        
        <div class="demo-section">
            <h2>üîí CSRF Protection</h2>
            <p>Automatic CSRF token management with cache-friendly dynamic injection:</p>
            
            <form class="demo-form" action="/demo/submit" method="post" data-ajax="true">
                <input type="text" name="name" placeholder="Your Name" required>
                <input type="email" name="email" placeholder="Your Email" required>
                <textarea name="message" placeholder="Your Message" rows="4" required></textarea>
                <button type="submit">Submit Form (AJAX)</button>
            </form>
            
            <div class="code-block">
// CSRF tokens are automatically injected into forms
// and AJAX requests by the TreeHouse framework

// Manual token access:
TreeHouse.use('csrf').then(csrf => {
    csrf.getToken().then(token => {
        console.log('CSRF Token:', token);
    });
});
            </div>
        </div>
        
        <div class="demo-section">
            <h2>üìù Enhanced Forms</h2>
            <p>Automatic form validation, AJAX submission, and user feedback:</p>
            
            <form class="demo-form" action="/demo/contact" method="post" data-treehouse-enable="true">
                <input type="text" name="username" placeholder="Username (min 3 chars)" 
                       data-validate="minlength" data-minlength="3" required>
                <input type="email" name="contact_email" placeholder="Email Address" required>
                <input type="url" name="website" placeholder="Website URL (optional)">
                <button type="submit">Submit with Validation</button>
            </form>
            
            <div class="code-block">
// Forms are automatically enhanced with:
// - Real-time validation
// - AJAX submission
// - Loading states
// - Error handling
// - CSRF protection

// Custom validators can be added:
TreeHouse.use('forms').then(forms => {
    forms.addValidator('username', (value) => {
        return value.length >= 3 || 'Username must be at least 3 characters';
    });
});
            </div>
        </div>
        
        <div class="demo-section">
            <h2>üõ†Ô∏è Utility Functions</h2>
            <p>Common utility functions for everyday development:</p>
            
            <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                <button onclick="demonstrateDebounce()">Test Debounce</button>
                <button onclick="demonstrateScrollTo()">Scroll to Top</button>
                <button onclick="demonstrateRandomString()">Generate Random String</button>
                <button onclick="demonstrateFormatting()">Format Numbers</button>
            </div>
            
            <div id="utility-output" style="margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 4px; min-height: 30px;">
                <em>Click buttons above to see utility functions in action</em>
            </div>
            
            <div class="code-block">
// Utility functions available:
TreeHouse.use('utils').then(() => {
    // Debouncing
    const debounced = TreeHouse.utils.debounce(() => {
        console.log('Debounced function called');
    }, 500);
    
    // Formatting
    const formatted = TreeHouse.utils.formatNumber(1234567.89);
    // Output: "1,234,567.89"
    
    // Deep object operations
    const data = { user: { name: 'John' } };
    const name = TreeHouse.utils.get(data, 'user.name', 'Anonymous');
    
    // And many more utilities...
});
            </div>
        </div>
        
        <div class="demo-section">
            <h2>üéØ Event System</h2>
            <p>Built-in event system for module communication:</p>
            
            <div class="code-block">
// Listen for TreeHouse events
TreeHouse.on('module:loaded', (data) => {
    console.log(`Module ${data.name} loaded successfully`);
});

// Listen for form events
TreeHouse.on('form:success', (data) => {
    console.log('Form submitted successfully', data);
});

// Emit custom events
TreeHouse.emit('app:notification', {
    message: 'Hello from TreeHouse!',
    type: 'success'
});
            </div>
        </div>
        
        <div class="demo-section">
            <h2>üìÅ Asset Serving</h2>
            <p>Vendor-first asset serving with application override support:</p>
            
            <div class="code-block">
// Assets are served from vendor package by default:
// /_assets/treehouse/js/treehouse.js
// /_assets/treehouse/js/modules/csrf.js

// Applications can override by placing files in:
// public/assets/treehouse/js/treehouse.js
// public/assets/treehouse/js/modules/csrf.js

// PHP Helpers for easy integration:
echo treehouseJs(['csrf', 'forms']); // Load specific modules
echo treehouseConfig(['debug' => true]); // Configure library
echo treehouseSetup(); // Complete setup in one call
            </div>
        </div>
    </div>
    
    <script>
        // Demo utility functions
        function demonstrateDebounce() {
            TreeHouse.ready(() => {
                if (TreeHouse.utils) {
                    const output = document.getElementById('utility-output');
                    let count = 0;
                    
                    const debounced = TreeHouse.utils.debounce(() => {
                        output.innerHTML = `<strong>Debounced function called ${++count} time(s)</strong><br>
                            Try clicking rapidly - the function only executes after you stop clicking for 500ms.`;
                    }, 500);
                    
                    // Simulate rapid calls
                    for (let i = 0; i < 5; i++) {
                        setTimeout(debounced, i * 50);
                    }
                } else {
                    document.getElementById('utility-output').innerHTML = '<em>Utils module not loaded yet</em>';
                }
            });
        }
        
        function demonstrateScrollTo() {
            TreeHouse.ready(() => {
                if (TreeHouse.utils) {
                    TreeHouse.utils.scrollTo(document.body, 0, 1000);
                    document.getElementById('utility-output').innerHTML = '<strong>Smoothly scrolling to top!</strong>';
                } else {
                    document.getElementById('utility-output').innerHTML = '<em>Utils module not loaded yet</em>';
                }
            });
        }
        
        function demonstrateRandomString() {
            TreeHouse.ready(() => {
                if (TreeHouse.utils) {
                    const randomStr = TreeHouse.utils.randomString(12);
                    document.getElementById('utility-output').innerHTML = 
                        `<strong>Random String:</strong> <code>${randomStr}</code>`;
                } else {
                    document.getElementById('utility-output').innerHTML = '<em>Utils module not loaded yet</em>';
                }
            });
        }
        
        function demonstrateFormatting() {
            TreeHouse.ready(() => {
                if (TreeHouse.utils) {
                    const number = 1234567.89;
                    const formatted = TreeHouse.utils.formatNumber(number);
                    const fileSize = TreeHouse.utils.formatFileSize(1048576);
                    
                    document.getElementById('utility-output').innerHTML = 
                        `<strong>Number:</strong> ${number} ‚Üí <code>${formatted}</code><br>
                         <strong>File Size:</strong> 1048576 bytes ‚Üí <code>${fileSize}</code>`;
                } else {
                    document.getElementById('utility-output').innerHTML = '<em>Utils module not loaded yet</em>';
                }
            });
        }
        
        // Update module status when modules load
        TreeHouse.on('module:loaded', (data) => {
            const moduleElement = document.querySelector(`[data-module="${data.name}"]`);
            if (moduleElement) {
                moduleElement.classList.remove('loading');
                moduleElement.classList.add('loaded');
                moduleElement.querySelector('.status').textContent = 'Loaded ‚úì';
            }
        });
        
        // Show when TreeHouse is ready
        TreeHouse.ready(() => {
            console.log('üå≥ TreeHouse Framework is ready!');
            console.log('Available modules:', TreeHouse.getModuleNames());
        });
    </script>
</body>
</html>